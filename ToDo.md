# CRM 3.0 Задачи для будущей разработки

## Завершённые функции ✅
- [x] Редактирование сделок (название, описание, клиент, даты)
- [x] Функционал задач в сделках (создание, редактирование, удаление)
- [x] Переработка финансовых моделей (Сделка → Полис → Платёж → Доходы/Расходы)

---

## Улучшения интерфейса

### 1. Улучшения управления клиентами
- [ ] **Компонент EditClientForm** - Создать форму для редактирования деталей клиента
  - Поддержка редактирования имени, телефона, email, адреса, даты рождения, заметок
  - Валидация входных данных перед отправкой
  - Обновление информации о клиенте через API и обновление локального состояния

- [ ] **Улучшенный список клиентов**
  - Добавить поиск/фильтр по имени или телефону клиента
  - Быстрый просмотр контактной информации в списке
  - Ссылка для просмотра всех сделок клиента

### 2. Система заметок по сделкам
- [ ] **Вкладка Notes в DealsView**
  - Добавление/редактирование/удаление заметок для сделок
  - Поддержка статуса заметки (активна/архивирована)
  - Отображение даты создания и автора для каждой заметки
  - Архивирование заметок вместо удаления

### 3. Улучшения управления задачами
- [ ] **Поддержка подзадач**
  - Добавление элементов чек-листа/подзадач в каждую задачу
  - Отметить подзадачи как выполненные
  - Показать прогресс (X из Y подзадач выполнено)

- [ ] **Уведомления о сроках выполнения задач**
  - Цветные индикаторы сроков:
    - Красный: Просрочено (отрицательное количество дней)
    - Красный: Срок сегодня
    - Оранжевый: Срок в течение 3 дней
  - Показать оставшееся количество дней с правильной русской склонностью

- [ ] **Назначение задач**
  - Назначить задачи членам команды
  - Отобразить имя назначенного лица в задаче
  - Фильтрация задач по исполнителю

### 4. Статус и рабочий процесс сделки
- [ ] **Расширенные опции статуса сделки**
  - Добавить более детальные статусы: "Новая", "Расчет", "Переговоры", "Оформление", "Ожидает продления"
  - Цветное кодирование статусов в интерфейсе

- [ ] **Модальное окно закрытия сделки**
  - При закрытии сделки показать модальное окно с запросом причины
  - Автоматически добавить причину в заметки сделки
  - Записать закрытие в историю действий

- [ ] **Поля владельца/ассистента сделки**
  - Добавить поля deal.owner и deal.assistant в backend
  - Назначить сделку членам команды
  - Показать информацию о назначенном лице в заголовке сделки
  - Создать список пользователей для dropdown назначения

### 5. Резюме и описание сделки
- [ ] **Отображение резюме сделки**
  - Показать краткое резюме на вкладке обзора сделки
  - Редактировать резюме встроенно или в модальном окне
  - Использовать для быстрого контекста сделки

### 6. Улучшения управления файлами
- [ ] **Улучшения загрузки файлов**
  - Показать размер файла в удобном для чтения формате (KB, MB, GB)
  - Иконки типов файлов (PDF, Word, Excel, Image и т.д.)
  - Кнопка для скачивания файла
  - Предпросмотр изображений

- [ ] **Массовая загрузка файлов**
  - Перетаскивание нескольких файлов
  - Индикатор прогресса во время загрузки

### 7. Чат и отслеживание действий
- [ ] **Вкладка журнала действий сделки**
  - Отобразить временную шкалу всех изменений сделки
  - Показать кто сделал изменение и когда
  - Типы логов: статус изменен, название обновлено, заметка добавлена, полис создан и т.д.

- [ ] **Улучшение системы чата**
  - Автопрокрутка к новым сообщениям
  - Аватары/инициалы пользователя
  - Временная метка для каждого сообщения
  - Функциональность удаления сообщения

### 8. Улучшения пользовательского интерфейса
- [ ] **Dropdown профиля пользователя**
  - Отображение информации текущего пользователя в заголовке
  - Кнопка выхода
  - Быстрый доступ к настройкам
  - Отображение аватара/инициалов пользователя

- [ ] **Состояния загрузки и спиннеры**
  - Добавить компонент LoadingSpinner для асинхронных операций
  - Показать состояния загрузки для API запросов
  - Скелетные экраны для загрузки данных

- [ ] **Всплывающие уведомления (Toast)**
  - Показать сообщения об успехе/ошибке/предупреждении
  - Автоматически закрываться после задержки
  - Правильная обработка ошибок с удобными для пользователя сообщениями

---

## Улучшения backend

### 1. Расширение модели Deal
- [ ] **Добавление полей в Deal**
  - `owner` (FK на User) - продавец
  - `assistant` (FK на User) - исполнитель
  - `summary` - краткое описание
  - Расширение опций статуса для включения большего количества этапов

- [ ] **Модель журнала действий**
  - Отслеживание всех изменений сделки
  - Сохранение кто сделал изменение и когда
  - Запись old_value и new_value для аудита

### 2. Backend системы заметок
- [ ] **Реализация модели Note**
  - Создать приложение/модель Note
  - Поддержка статуса активна/архивирована
  - Отслеживание даты создания и автора
  - Добавить сериализатор и viewset

### 3. Улучшения задач
- [ ] **Подзадачи**
  - Добавить модель Subtask с parent FK на Task
  - Поддержка отслеживания выполнения

- [ ] **Исполнитель задачи**
  - Добавить FK исполнителя на модель User
  - Обеспечить правильные разрешения/авторизацию

### 4. Улучшения финансовых транзакций
- [ ] **Улучшение FinancialTransaction**
  - Добавить поле `paymentDate` для отслеживания фактических платежей
  - Добавить поля `source` и `category`
  - Связать с Payment где применимо
  - Поддержка отметки транзакций как оплачено

### 5. Пользователи и разрешения
- [ ] **Управление пользователями**
  - Создать endpoints управления пользователями
  - Список всех пользователей для dropdowns
  - Endpoint профиля пользователя

- [ ] **Разрешения и авторизация**
  - Реализовать правильные DRF разрешения
  - Ограничить доступ к endpoints по роли пользователя
  - Заменить AllowAny на правильную аутентификацию

### 6. Аудит и логирование
- [ ] **Реализация журнала аудита**
  - Записать created_by и updated_by во всех моделях
  - Автоматическое захватывание контекста пользователя
  - Записи ActivityLog для основных операций

---

## Улучшения API

### 1. Поиск и фильтрация
- [ ] **Поиск сделок**
  - Поиск сделок по названию, имени клиента
  - Фильтрация по статусу, владельцу, диапазону дат

- [ ] **Поиск клиентов**
  - Поиск по имени, телефону, email
  - Пагинация для больших наборов результатов

- [ ] **Пагинация**
  - Реализовать пагинацию limit/offset
  - Добавить ко всем endpoints списков
  - Обработка пагинированных результатов в frontend

### 2. Массовые операции
- [ ] **Массовое обновление статуса сделок**
  - Обновить несколько сделок одновременно
  - Endpoint массовых операций

- [ ] **Функциональность экспорта**
  - CSV экспорт сделок
  - PDF экспорт деталей сделки
  - Экспорт финансового резюме

### 3. Отчётность
- [ ] **Endpoint финансового резюме**
  - Общий доход/расходы за период
  - По типу полиса, клиенту или пользователю
  - Метрики производительности

- [ ] **Отчёт по конвейеру сделок**
  - Количество сделок по статусам
  - Метрики процента побед
  - Средняя стоимость сделки

---

## Интеграция и продвинутые функции

### 1. Интеграция ИИ/LLM (Gemini API)
- [ ] **Преобразование текста в речь**
  - Генерировать аудио из резюме сделки
  - Проигрывание аудио через Web Audio API
  - Кнопка со значком динамика в заголовке сделки

- [ ] **Авто-генерация резюме сделки ИИ**
  - Автоматически генерировать резюме сделки из заметок
  - Предлагать следующие действия на основе статуса сделки

- [ ] **Функции ИИ помощника**
  - Черновики шаблонов писем для контакта с клиентом
  - Предложить последующие задачи

### 2. Интеграция электронной почты
- [ ] **Отправка письма из сделки**
  - Составление и отправка письма клиенту
  - Библиотека шаблонов писем
  - Отслеживание открытий/кликов писем

### 3. Уведомления
- [ ] **Оповещения о просроченных задачах**
  - Уведомлять пользователей о просроченных задачах
  - Напоминания о предстоящих датах контактов
  - Уведомления о сроках платежей

### 4. Мобильная адаптивность
- [ ] **Улучшения мобильного интерфейса**
  - Адаптивные сетки макетов
  - Мобильные модальные окна
  - Кнопки и входные поля удобные для касания
  - Тестирование на различных размерах экрана

---

## Тестирование и качество

### 1. Frontend тесты
- [ ] **Модульные тесты**
  - Тесты функций API клиента
  - Тесты валидации форм
  - Тесты управления состоянием

- [ ] **Тесты компонентов**
  - Тесты отдельных компонентов
  - Тесты взаимодействия пользователя
  - Тесты состояний ошибок

### 2. Backend тесты
- [ ] **Тесты моделей**
  - Тесты валидации моделей
  - Тесты методов моделей

- [ ] **Тесты API**
  - Тесты функциональности endpoints
  - Тесты разрешений
  - Тесты обработки ошибок

### 3. End-to-End тесты
- [ ] **Тесты пользовательских потоков**
  - Тест полного потока создания сделки
  - Тест потока обновления сделки
  - Тест потока отслеживания платежей

---

## Документация и DevOps

### 1. Документация
- [ ] **Документация API**
  - OpenAPI/Swagger спецификации
  - Описания endpoints
  - Примеры запросов/ответов

- [ ] **Документация компонентов Frontend**
  - Настройка Storybook
  - Документация props компонентов

### 2. Развертывание
- [ ] **Улучшения Docker**
  - Многоэтапные сборки для оптимизации
  - Endpoints проверки здоровья
  - Правильная конфигурация логирования

- [ ] **CI/CD конвейер**
  - Настройка GitHub Actions
  - Автоматизированное тестирование на PR
  - Автоматизированное развертывание

---

## Уровни приоритета

### Высокий приоритет (Следующий спринт)
1. Компонент EditClientForm
2. Система заметок по сделкам
3. Модальное окно закрытия сделки с причиной
4. Dropdown профиля пользователя
5. Backend журнала действий

### Средний приоритет (Следующие спринты)
1. Подзадачи и назначение задач
2. Улучшения файлов (предпросмотр, массовая загрузка)
3. Расширенный рабочий процесс статусов сделок
4. Поиск и фильтрация
5. Улучшения платежей

### Низкий приоритет (Будущее)
1. Интеграция ИИ/TTS
2. Интеграция электронной почты
3. Продвинутая отчётность
4. Оптимизация мобильного
5. Полное покрытие тестами

---

## Примечания
- Все изменения backend требуют миграций базы данных
- Сохранять обратную совместимость с существующим API
- Обновлять frontend типы при изменении backend моделей
- Поддерживать согласованность со стилем и паттернами существующего кода
