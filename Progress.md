# План выравнивания фронтенда с frontend_example

## 1. Вкладочный рабочий стол сделки — СДЕЛАНО
- ✅ Реализованы вкладки в `frontend/src/components/views/DealsView.tsx` (Обзор, Задачи, Расчеты, Чат, Файлы, Полисы, Финансы, Заметки, История) по мотивам `frontend_example/components/ClientDetails.tsx:417`.
- ✅ Переписан layout карточки сделки: заголовок, метрики и контент теперь живут внутри табов.
- Следующий шаг: при появлении новых сущностей (файлы, чат, расчеты и т. д.) заполнить соответствующие вкладки данными и действиями.

## 2. Сквозной процесс работы с расчетами
- Расширить интерфейс `Deal` (`frontend/src/types.ts`) полем `quotes`; обновить API-слой (`frontend/src/api.ts`) для чтения/создания/удаления расчетов.
- Импортировать и адаптировать `AddQuoteForm` из `frontend_example/components/AddQuoteForm.tsx`, добавить валидацию сумм и премий, локализацию меток.
- В карточке сделки вывести список расчетов и действия «Создать полис»/«Удалить» (ориентир — `frontend_example/components/ClientDetails.tsx:526-537`).

## 3. Мастер создания полиса
- Перенести модалку `AddPolicyForm` (`frontend_example/components/AddPolicyForm.tsx:14`), включая поиск клиента и динамическое добавление взносов (`строки 63 и 233`).
- Добавить кнопку «Создать полис» в DealsView/PoliciesView; по submit дергать новый API endpoint и добавлять полис в локальный state без перезагрузки.
- Синхронизировать модель Policy и список платежей, чтобы рассрочка сразу появлялась в PaymentsView.

## 4. Менеджер вложений
- Дополнить `Deal` полем `files`, реализовать API-заглушки для загрузки/удаления файлов (multipart POST/DELETE в `frontend/src/api.ts`).
- Перенести UI из `frontend_example/components/ClientDetails.tsx:595-610`: input type="file", список файлов, кнопки удаления, индикаторы размера.
- Добавить обработку состояния загрузки и ошибок, хранить временные ссылки для предпросмотра.

## 5. Встроенный чат сделки
- Добавить тип `ChatMessage` и свойство `chat` в модель `Deal`, реализовать API-методы `fetchDealChat`/`postChatMessage`.
- Импортировать форму и ленту чата (`frontend_example/components/ClientDetails.tsx:557-575` + хендлер `363`), адаптировать стили под production UI.
- Настроить минимум polling/мгновенное обновление списка после отправки, опционально — веб-сокеты.

## 6. Ручной учет финансовых транзакций
- Завести тип `FinancialTransaction` и API-функции; перенести `AddFinancialTransactionForm` (`frontend_example/components/AddFinancialTransactionForm.tsx:11`).
- Переписать `frontend/src/components/views/FinanceView.tsx`, используя функциональность примера (`frontend_example/components/views/FinanceView.tsx:58`): фильтры по статусу, поиск, inline-редактирование сумм, подтверждение оплаты.
- Связать транзакции с полисами/сделками для навигации из таблицы.

## 7. Хронология действий
- Добавить `activityLog` в модель `Deal`, расширить API для получения истории изменений.
- Перенести компонент из `frontend_example/components/ClientDetails.tsx:745-760`, обеспечив сортировку по времени и отображение пользователя/действия.
- Вывести историю во вкладке «История» и обновлять ее после ключевых операций (создание заметки, изменение статуса и т. д.).

## 8. Голосовой/TTS-ассистент
- Подключить `@google/genai`, перенести сервис `frontend_example/services/geminiService.ts:1-70`, хранить API-ключ в `.env` (`VITE_GEMINI_API_KEY`).
- Интегрировать `TTSButton` (`frontend_example/components/TTSButton.tsx`) в ключевые блоки (название сделки, заметки), предусмотреть graceful fallback при отсутствии ключа.
- Добавить устойчивую обработку ошибок: тосты, повторное включение кнопки после неудачи, логирование.
