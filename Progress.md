# План выравнивания фронтенда с frontend_example

## 1. Вкладочный рабочий стол сделки — СДЕЛАНО
- В `frontend/src/components/views/DealsView.tsx` добавлены девять вкладок по мотивам `frontend_example/components/ClientDetails.tsx:417`.
- Карточка сделки разделена на блоки, метрики и подробности отображаются в соответствующих вкладках.
- Следующий шаг: заполнить остальные вкладки данными по мере реализации связанных фич.

## 2. Сквозной процесс работы с расчетами — СДЕЛАНО
- На бэкенде добавлена модель `Quote`, API `/api/v1/quotes/` и возврат встроенных расчетов в `DealSerializer`.
- На фронте реализован `AddQuoteForm`, вкладка «Расчеты» показывает список и поддерживает добавление/удаление через API (`frontend/src/components/views/DealsView.tsx`, `frontend/src/App.tsx`).
- Следующий шаг: связать расчеты с мастером полиса, чтобы создавать полис прямо из расчета.

## 3. Мастер создания полиса — СДЕЛАНО
- Реализована форма `AddPolicyForm` с полями для номера, компании, типа, VIN, дат и суммы полиса.
- Форма поддерживает создание платежа одновременно с полисом (чекбокс «Создать платеж сразу»).
- На бэкенде добавлены функции `createPolicy()` и `createPayment()` в API.
- В DealsView реализована вкладка «Полисы» с кнопками «Создать полис» и «Удалить».
- Платежи автоматически синхронизируются в PaymentsView через состояние приложения.
- Состояние обновляется без перезагрузки благодаря useState и setPayments/setPolicies.

## 4. Менеджер вложений — СДЕЛАНО
- Реализован компонент `FileUploadManager` с поддержкой drag-and-drop, индикатором прогресса и отображением размера файла.
- На бэкенде обновлен `DealSerializer` для встроенного вывода документов (DocumentBriefSerializer).
- На фронте добавлены API функции `uploadDocument()` и `deleteDocument()` с поддержкой FormData для загрузки файлов.
- Вкладка "Файлы" в DealsView полностью функциональна с загрузкой, удалением и отображением файлов.
- Поддерживаются эмодзи-иконки для разных типов файлов (PDF, Word, Excel, видео, изображения и т.д.).
- Обработаны состояния загрузки, ошибок, и валидация размера (макс 100 МБ).

## 5. Встроенный чат сделки
- Завести сущность `ChatMessage`, API для получения и отправки сообщений.
- Перенести список + форму из примера, адаптировать стили, предусмотреть обновление после отправки (polling/websocket позже).

## 6. Ручной учет финансовых транзакций
- Добавить тип `FinancialTransaction`, API и форму `AddFinancialTransactionForm`.
- Переписать `frontend/src/components/views/FinanceView.tsx`, добавив фильтры, поиск, изменение сумм и отметку оплаты.
- Связать транзакции с полисами/сделками для навигации.

## 7. Хронология действий
- Расширить `Deal` полем `activityLog`, добавить API-эндпоинт.
- Перенести компонент истории из примера, выводить пользователя/время/действие и обновлять после ключевых операций.

## 8. Голосовой/TTS-ассистент
- Подключить `@google/genai`, перенести сервис `geminiService`, добавить `VITE_GEMINI_API_KEY`.
- Интегрировать `TTSButton` в важные блоки (название сделки, заметки) и обеспечить graceful fallback.
- Добавить обработку ошибок (тосты, повтор), логирование и флаг отключения.
