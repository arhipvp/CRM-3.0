# Сопоставление сценариев CRM_2.0 и спецификации CRM 3.0

## 1. Источники
- `CRM_2.0/docs/processes.md` — таблица событий, распределение ролей, базовый сценарий сделки.
- `C:/Dev/CRM 3.0/crm3-specification.md` — актуальная модель для Django + React.

## 2. Ключевой сценарий CRM_2.0
1. **События по полису клиента**: плановые платежи, пролонгации, окончание действия, просрочки и изменение условий. Для каждого события заранее заданы сроки напоминаний, ответственные роли, канал уведомлений (CRM + Telegram) и формат задачи.
2. **Распределение ролей**:
   - Продавец — контактирует с клиентом, фиксирует договоренности, подтверждает оплаты.
   - Исполнитель — готовит расчёты, документы, претензии, обновляет статус пролонгаций.
   - Главный админ — контролирует поступления, закрывает задачи и принимает эскалации.
3. **Уведомления**: каждое событие автоматически дублируется в CRM и Telegram, ручного выбора канала нет.
4. **Журнал контроля**: таблица для фиксации проверок (дата, клиент, номер полиса, сумма, ответственный, статус, комментарии).
5. **Базовый процесс сделки**:
   - Продавец создаёт клиента/сделку, прикладывает документы, ставит задачу на расчёты.
   - Исполнитель рассчитывает варианты и возвращает данные в сделку.
   - Продавец согласует с клиентом и ставит задачу на оформление.
   - После оплаты документ полиса добавляется в «папку сделки», таблица полисов обновляется, фиксируются комиссии/расходы.
   - Сделка переходит в режим ожидания следующего события; движения средств отражаются в CRM.

## 3. Попадания в спецификацию CRM 3.0
- **Модель клиента и сделок**: `Client`, `Contact`, `Deal`, `DealStage`, `DealParticipant` повторяют базовые объекты сценария.
- **Задачи, документы, уведомления**: сущности `Task`, `Document`, `Notification`, `Activity`, `Note` покрывают создание напоминаний, ведение файлов и журнал действий.
- **Роли**: `admin`, `seller`, `executor` напрямую соответствуют «главному админу», «продавцу» и «исполнителю».
- **Frontend-модули**: «Клиенты», «Сделки», «Задачи», «Документы», «Уведомления» отражают рабочие страницы, описанные в сценарии.

## 4. Выявленные расхождения
| # | Область | Наблюдение | Возможная доработка |
| --- | --- | --- | --- |
| 1 | Полисы и продукты | В сценарии центральный объект — полис с пролонгациями и платежами. В спецификации есть только `Deal` и `DealProduct`. | Добавить сущность `Policy` (номер, срок действия, премии, статус), связать её с `Deal`/`Client`, предусмотреть логику пролонгаций. |
| 2 | Финансовые движения | Журнал контроля фиксирует даты платежей, суммы комиссий и расходов. В спецификации нет модели для поступлений/выплат. | Ввести `Payment`/`CommissionEntry` (тип, сумма, дата, связь с полисом/сделкой) и шаблон журнала в UI. |
| 3 | Автоматические напоминания | Таблица событий определяет SLA и эскалации (14/3 дня, 24 часа на реакцию). В CRM 3.0 описаны только ручные `Task`. | Добавить движок шаблонов событий (`EventRule`: триггер, дедлайны, роли, каналы) и фоновый планировщик, который создаёт задачи и уведомления. |
| 4 | Telegram | В CRM_2.0 уведомления всегда уходят в Telegram-канал. Спецификация упоминает лишь web-уведомления и заглушки email/SMS. | Спроектировать интеграцию Telegram (webhook + боты) и указать её в roadmap или разделе уведомлений. |
| 5 | Расчёты и претензии | Исполнитель готовит расчёты как отдельную сущность и претензионные документы. В модели нет объекта для расчётов/претензий. | Добавить `Calculation`/`Quote` и `ClaimDocument`, либо расширить `Document` атрибутами типа и статуса. |
| 6 | Папка сделки и хранение версий | Сценарий требует «папку сделки» с версиями документов и журналом обновлений. В спецификации упомянута только таблица `Document` без структуры каталогов. | Уточнить логику хранения файлов (например, `documents/{deal_id}/...`), добавить версионность/метки типа. |

## 5. Рекомендации
1. Дополнить спецификацию разделом про полисы и финансовые операции, чтобы сценарии пролонгации и контроля поступлений переносились без ручных решений.
2. Включить Telegram как обязательный канал в разделе уведомлений/roadmap и описать минимальный API (webhook, шаблоны сообщений).
3. Описать механизм шаблонов событий и SLA (генерация задач по расписанию, эскалации через уведомления).
4. Уточнить структуру документов сделки: каталог, версионность, связь с шаблонами и задачами исполнителей.

Документ можно использовать как чек-лист при последующих изменениях спецификации CRM 3.0.
